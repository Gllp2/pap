<?php
session_start();

if (!isset($_SESSION['utilizador']) || $_SESSION['utilizador'] !== 'Gllp') {
    header("Location: login.html");
    exit;
}

// Database connection details
$dsn = "SAGE";
$user = "SA";
$password = "sage2008+";

// Establishing the connection
$conn = odbc_connect($dsn, $user, $password);

if (!$conn) {
    die("Connection failed: " . odbc_errormsg());
}

// Getting the ID of the feedback to delete
$id = $_POST['id'];

// SQL query to delete the feedback
$sql = "DELETE FROM [PAP].[dbo].[FeedBack] WHERE [ID] = ?";
$stmt = odbc_prepare($conn, $sql);

if (!$stmt) {
    die("Error in preparing statement: " . odbc_errormsg($conn));
}

$result = odbc_execute($stmt, [$id]);

if ($result) {
    echo "Feedback deleted successfully!";
} else {
    echo "Error in deleting feedback: " . odbc_errormsg($conn);
}

// Closing the connection
odbc_close($conn);

// Redirect back to the feedback page
header("Location: view_feedback.php");
exit;
?>
